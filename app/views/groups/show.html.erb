<div class="block">
  <div class="content clearfix">
    <h2><%= t("group.show", :group => @group.name) %></h2>
    <div class="inner grid_12 alpha">
      <%= render_list :class => 'menu' do |list|
        list << link_to(t("group.joined_users"), group_users_path(@group)) if @current_user.manager?(@group)
        list << link_to(t("group.requiest_to_join"), join_user_group_path(@current_user, @group)) if @current_user.not_join?(@group)
        list << link_to(t("group.quit"), user_group_path(@current_user,@group), :method => :delete, :confirm => t("group.quit_confirm")) if !@current_user.manager?(@group) && @current_user.join?(@group)
        list << link_to(t("group.all_expenses"), group_expenses_path(@group)) if @current_user.approved?(@group)
        list << link_to(t("group.add_outgoing_expense"), new_group_expense_path(@group, :kind => :outgoing)) if @current_user.approved?(@group)
        list << link_to(t("group.add_income_expense"), new_group_expense_path(@group, :kind => :income)) if @current_user.approved?(@group)
        list << link_to(t("edit"), edit_group_path(@group)) if @current_user.manager?(@group)
      end -%>
      <br /><br />
      <p><%=h Group.human_attribute_name("name") %>: <%=h @group.name %></p>
      <p><%=h Group.human_attribute_name("short_name") %>: <%=h @group.short_name %></p>
      <% if @current_user.approved?(@group) -%>
        <p><%=h Group.human_attribute_name("total") %>: <%=h number_to_currency(@group.expenses.total, :precision => 0) %> </p>
        <div class="inner grid_6 alpha">
          <table class='table'>
            <tr>
              <th colspan='2'><%= t("expenses.user_report") %></th>
            </tr>
            <% @users.each do |user| -%>
              <%= render :partial => "item", :locals => {:name => user.to_brief_info, :total => user.expenses.by_group(@group).total} %>
            <% end -%>
            <%= render :partial => 'total', :locals => {:total => @group.expenses.total} %>
          </table>
        </div>
        <div class="inner grid_6 omega">
          <table class='table'>
            <tr>
              <th colspan='2'><%= t("expenses.tag_report") %></th>
            </tr>
            <% (@income_tags + @outgoing_tags).each do |tag| -%>
              <%= render :partial => "item", :locals => {:name => tag.name, :total => tag.expenses.by_group(@group).total} %>
            <% end -%> 
            <%= render :partial => 'total', :locals => {:total => @group.expenses.total} %>
          </table>
        </div>
        <!--
        <hr /> 
        <div class="inner grid_6 alpha">
          <% summary_array = Array.new -%>
          <% @users.each do |user|
            summary_array << {:name => user.login, :percent => ((user.expenses.by_group(@group).total / @group.expenses.total).round(3) * 100).to_i.to_s}
          end -%>
          <% src = "http://chart.apis.google.com/chart?chtt=#{t("expenses.user_report")}&cht=p3&chs=400x200&chco=ff0000,00ff00,0000ff&chd=t:" + summary_array.map{|item| item[:percent]}.join(",")+"&chl=" + summary_array.map{|item| item[:name]}.join("|") %>
          <%= image_tag src %>
        </div>
        <div class="inner grid_6 omega">
          <% summary_array = Array.new -%>
          <%  (@income_tags + @outgoing_tags).each do |tag|
            summary_array << {:name => tag.name, :percent => (( tag.expenses.by_group(@group).total / @group.expenses.total).round(3) * 100).to_i.to_s}
          end -%>
          <% src = "http://chart.apis.google.com/chart?chtt=#{t("expenses.tag_report")}&cht=p3&chs=400x200&chco=ff0000,00ff00,0000ff&chd=t:" + summary_array.map{|item| item[:percent]}.join(",")+"&chl=" + summary_array.map{|item| item[:name]}.join("|") %>
          <%= image_tag src %>
        </div>
        -->
      <% end -%>
    </div>
  </div>
</div>


